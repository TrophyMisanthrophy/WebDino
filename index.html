<script>
const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');

function resize() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
resize();
window.addEventListener('resize', resize);

let dino = {x: 80, y: 0, w: 60, h: 70, dy: 0, grav: 0.7, jumpPower: -18, grounded: true};
let obstacles = [];
let score = 0;
let hiScore = localStorage.getItem('dinoHi') || 0;
let speed = 7;
let gameOver = false;
let frames = 0;
let isNight = false;

function getGroundY() { return canvas.height - 100; }  // ← вот эта строчка всё исправила

function jump(e) {
  if (e) e.preventDefault();
  if (gameOver) { location.reload(); return; }
  if (dino.grounded) { dino.dy = dino.jumpPower; dino.grounded = false; }
}
canvas.addEventListener('click', jump);
canvas.addEventListener('touchstart', jump);

function spawn() {
  const h = 60 + Math.random() * 80;
  obstacles.push({x: canvas.width + 50, w: 35 + Math.random() * 50, h});
}

function loop() {
  frames++;
  score += 0.2;

  // день ↔ ночь каждые 700 очков
  isNight = Math.floor(score / 700) % 2 === 1;

  if (frames % 70 === 0) spawn();
  if (frames % 350 === 0) speed += 0.4;

  const groundY = getGroundY();
  dino.y = Math.min(dino.y, groundY - dino.h);
  
  // физика динозавра
  dino.dy += dino.grav;
  dino.y += dino.dy;
  if (dino.y >= groundY - dino.h) {
    dino.y = groundY - dino.h;
    dino.dy = 0;
    dino.grounded = true;
  }

  // препятствия
  obstacles.forEach(o => o.x -= speed);
  obstacles = obstacles.filter(o => o.x + o.w > -200);

  // столкновение
  for (let o of obstacles) {
    if (dino.x + dino.w > o.x && dino.x < o.x + o.w && dino.y + dino.h > groundY - o.h) {
      gameOver = true;
      if (score > hiScore) {
        hiScore = score;
        localStorage.setItem('dinoHi', Math.floor(score));
      }
    }
  }

  // отрисовка
  ctx.fillStyle = isNight ? '#111111' : '#87CEEB';
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  ctx.fillStyle = isNight ? '#333333' : '#8B7355';
  ctx.fillRect(0, groundY, canvas.width, canvas.height - groundY);

  // динозавр
  ctx.fillStyle = isNight ? '#eeeeee' : '#22c55e';
  ctx.fillRect(dino.x, dino.y, dino.w, dino.h);

  // кактусы
  ctx.fillStyle = isNight ? '#aaaaaa' : '#dc2626';
  obstacles.forEach(o => ctx.fillRect(o.x, groundY - o.h, o.w, o.h));

  // счёт и рекорд
  ctx.fillStyle = isNight ? '#ffffff' : '#000000';
  ctx.font = 'bold 44px Arial';
  ctx.fillText(`Счёт: ${Math.floor(score)}`, 25, 70);
  ctx.fillText(`Рекорд: ${Math.floor(hiScore)}`, 25, 130);

  if (gameOver) {
    ctx.fillStyle = 'rgba(0,0,0,0.85)';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.fillStyle = '#fff';
    ctx.font = 'bold 90px Arial';
    ctx.textAlign = 'center';
    ctx.fillText('GAME OVER', canvas.width/2, canvas.height/2 - 30);
    ctx.font = 'bold 54px Arial';
    ctx.fillText('Тапни → начать заново', canvas.width/2, canvas.height/2 + 60);
    ctx.textAlign = 'start';
  }

  requestAnimationFrame(loop);
}

spawn(); spawn(); spawn();
loop();
</script>
