<script>
// Адаптивный размер canvas
const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');

function resize() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
resize();
window.addEventListener('resize', resize);

// === ВСЯ ИГРА ===
let dino = {x:80, y:250, w:50, h:60, dy:0, grav:0.7, jumpPower:-16, grounded:true};
let obstacles = [];
let score = 0;
let speed = 6;
let gameOver = false;
let frames = 0;
let groundY = canvas.height - 90; // земля всегда внизу

function jump(e){
  if(e) e.preventDefault();
  if(dino.grounded || gameOver){
    if(gameOver) location.reload();
    dino.dy = dino.jumpPower;
    dino.grounded = false;
  }
}

canvas.addEventListener('click', jump);
canvas.addEventListener('touchstart', jump);

function spawn(){
  const minW = 30, maxW = 70;
  const minH = 50, maxH = 100;
  obstacles.push({
    x: canvas.width + 50,
    w: minW + Math.random()*(maxW-minW),
    h: minH + Math.random()*(maxH-minH)
  });
}

function loop(){
  if(gameOver) return;

  frames++;
  score += 0.15;
  if(frames % Math.max(60, 120-speed*5) === 0) spawn();
  if(frames % 400 === 0) speed += 0.5;

  // динозавр
  dino.dy += dino.grav;
  dino.y += dino.dy;
  if(dino.y > groundY - dino.h){
    dino.y = groundY - dino.h;
    dino.dy = 0;
    dino.grounded = true;
  }

  // препятствия
  obstacles = obstacles.filter(o => o.x + o.w > -100);
  obstacles.forEach(o => o.x -= speed);

  // столкновение
  for(let o of obstacles){
    if(dino.x + dino.w > o.x && dino.x < o.x + o.w &&
       dino.y + dino.h > groundY - o.h){
      gameOver = true;
    }
  }

  // рисуем
  ctx.fillStyle = '#87CEEB'; ctx.fillRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle = '#8B7355'; ctx.fillRect(0, groundY, canvas.width, canvas.height-groundY);

  // динозавр (чуть крупнее на телефоне)
  ctx.fillStyle = '#22c55e';
  ctx.fillRect(dino.x, dino.y, dino.w, dino.h);

  // препятствия
  ctx.fillStyle = '#dc2626';
  obstacles.forEach(o => ctx.fillRect(o.x, groundY - o.h, o.w, o.h));

  // счёт
  ctx.fillStyle = '#000';
  ctx.font = 'bold 40px Arial';
  ctx.fillText(`Счёт: ${Math.floor(score)}`, 30, 70);

  if(gameOver){
    ctx.fillStyle = 'rgba(0,0,0,0.75)';
    ctx.fillRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle = '#fff';
    ctx.font = 'bold 80px Arial';
    ctx.textAlign = 'center';
    ctx.fillText('GAME OVER', canvas.width/2, canvas.height/2 - 40);
    ctx.font = 'bold 50px Arial';
    ctx.fillText('Тапни → новая игра', canvas.width/2, canvas.height/2 + 40);
    ctx.textAlign = 'start';
  }

  requestAnimationFrame(loop);
}

spawn(); spawn();
loop();
</script>
